"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getRevokedAssertions;

require("core-js/modules/es.promise.js");

var _services = require("../../../services");

var _models = require("../../../models");

var _constants = require("../../../constants");

var _useCases = require("../../i18n/useCases");

var _url = require("../../../helpers/url");

const ASSERTION_ID_NAME = 'assertionId';

async function getRevokedAssertions(revocationListUrl, assertionId) {
  var _issuerRevocationJson;

  if (!revocationListUrl) {
    return [];
  }

  const errorMessage = (0, _useCases.getText)('errors', 'getRevokedAssertions');

  if (assertionId) {
    revocationListUrl = (0, _url.safelyAppendUrlParameter)(revocationListUrl, ASSERTION_ID_NAME, encodeURIComponent(assertionId));
  }

  const response = await (0, _services.request)({
    url: revocationListUrl
  }).catch(() => {
    throw new _models.VerifierError(_constants.SUB_STEPS.parseIssuerKeys, errorMessage);
  });
  const issuerRevocationJson = JSON.parse(response);
  return (_issuerRevocationJson = issuerRevocationJson.revokedAssertions) !== null && _issuerRevocationJson !== void 0 ? _issuerRevocationJson : [];
}