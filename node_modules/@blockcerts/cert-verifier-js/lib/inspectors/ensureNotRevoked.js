"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = ensureNotRevoked;

var _verifierError = _interopRequireDefault(require("../models/verifierError"));

var _verificationSubSteps = require("../constants/verificationSubSteps");

var _domain = _interopRequireDefault(require("../domain"));

var _array = require("../helpers/array");

function ensureNotRevoked(revokedAddresses, keys) {
  if (!revokedAddresses || !keys) {
    // nothing to do
    return;
  }

  if (!Array.isArray(keys)) {
    keys = [keys];
  }

  keys = keys.filter(key => key != null);
  const matches = (0, _array.intersect)(keys, revokedAddresses.map(assertion => assertion.id));

  if (matches.length > 0) {
    const indexOfMatch = revokedAddresses.findIndex(address => address.id === matches[0]);

    if (indexOfMatch > -1) {
      throw new _verifierError.default(_verificationSubSteps.SUB_STEPS.checkRevokedStatus, _domain.default.certificates.generateRevocationReason(revokedAddresses[indexOfMatch].revocationReason));
    }
  }
}