"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = parseV2;

require("core-js/modules/es.symbol.description.js");

var _domain = _interopRequireDefault(require("../domain"));

var _constants = require("../constants");

var _getSignatureImage = _interopRequireDefault(require("./helpers/getSignatureImage"));

/**
 * parseV2
 *
 * @param certificateJson
 * @returns {Certificate}
 */
function parseV2(certificateJson) {
  const {
    id,
    expires,
    signature: receipt,
    badge
  } = certificateJson;
  const {
    image: certificateImage,
    name,
    description,
    subtitle,
    issuer
  } = badge;
  const issuerKey = certificateJson.verification.publicKey || certificateJson.verification.creator;
  const recipientProfile = certificateJson.recipientProfile || certificateJson.recipient.recipientProfile;
  const version = _constants.CERTIFICATE_VERSIONS.V2_0;

  const chain = _domain.default.certificates.getChain(issuerKey, certificateJson.signature);

  const issuedOn = certificateJson.issuedOn;
  const metadataJson = certificateJson.metadataJson;
  const recipientFullName = recipientProfile.name;
  const revocationKey = null;
  const sealImage = issuer.image;
  const signatureImage = (0, _getSignatureImage.default)(badge.signatureLines, version);
  return {
    certificateImage,
    chain,
    description,
    expires,
    id,
    issuedOn,
    issuer,
    metadataJson,
    name,
    receipt,
    recipientFullName,
    recordLink: id,
    revocationKey,
    sealImage,
    signature: null,
    signatureImage,
    subtitle,
    version
  };
}