"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.retrieveBlockcertsVersion = retrieveBlockcertsVersion;

var _index = require("./index");

var _string = require("../helpers/string");

function lookupVersion(array, v) {
  return array.some(str => str.includes(`v${v}`) || str.includes(`${v}.`));
}

function filterBlockcertsContext(contextList) {
  return contextList.find(ctx => ctx.toLowerCase().indexOf('blockcerts') > 0);
}

function filterStringContexts(context) {
  return context.filter(_string.isString);
}

function retrieveBlockcertsVersion(context) {
  if (typeof context === 'string') {
    context = [context];
  }

  const blockcertsContext = filterBlockcertsContext(filterStringContexts(context));
  const blockcertsContextArray = blockcertsContext.split('/').filter(str => str !== '');
  const availableVersions = Object.keys(_index.versionParserMap);
  return parseInt(availableVersions.filter(version => lookupVersion(blockcertsContextArray, version.toString()))[0], 10);
}